---
title: Session
description: JavaScript/TypeScript Session class reference
---

# Session

The Session class manages multi-turn conversations with Claude. It matches the official Claude Agent SDK V2 interface.

## Creating Sessions

Sessions are created via the client. Connection happens automatically on first `send()`.

```typescript
import { ChuckyClient, getAssistantText } from '@chucky.cloud/sdk';

const client = new ChuckyClient({ token });

const session = client.createSession({
  model: 'claude-sonnet-4-5-20250929',
  systemPrompt: 'You are a helpful assistant.',
});
```

## Methods

### send()

Send a message to Claude. Returns a Promise that resolves when the message is sent.
Use `stream()` to receive the response.

```typescript
async send(message: string): Promise<void>
```

#### Example

```typescript
await session.send('What is the capital of France?');

for await (const msg of session.stream()) {
  if (msg.type === 'assistant') {
    console.log(getAssistantText(msg));
  }
  if (msg.type === 'result') {
    console.log('Done:', msg.result);
  }
}
```

---

### stream()

Stream the response after sending a message. Returns an async generator that yields SDK messages.

```typescript
async *stream(): AsyncGenerator<SDKMessage, void, unknown>
```

#### SDKMessage Types

| Type | Description |
|------|-------------|
| `system` | System initialization message with session info |
| `assistant` | Claude's response with content blocks |
| `result` | Final result with cost and usage info |
| `stream_event` | Partial streaming events |

#### Example

```typescript
await session.send('Tell me a story');

for await (const msg of session.stream()) {
  switch (msg.type) {
    case 'system':
      console.log('Session:', msg.session_id);
      console.log('Model:', msg.model);
      break;
    case 'assistant':
      const text = getAssistantText(msg);
      if (text) process.stdout.write(text);
      break;
    case 'result':
      if (msg.subtype === 'success') {
        console.log('\n\nFinal:', msg.result);
        console.log('Cost:', msg.total_cost_usd);
      }
      break;
  }
}
```

---

### receive()

Alias for `stream()` for V2 compatibility.

```typescript
receive(): AsyncGenerator<SDKMessage, void, unknown>
```

---

### close()

Close the session and release resources.

```typescript
close(): void
```

#### Example

```typescript
try {
  await session.send('Hello');
  for await (const msg of session.stream()) {
    // handle messages
  }
} finally {
  session.close();
}
```

---

### on()

Register event handlers.

```typescript
on(handlers: SessionEventHandlers): this
```

#### SessionEventHandlers

| Handler | Parameters | Description |
|---------|------------|-------------|
| `onSessionInfo` | `(info: SessionInfo)` | Session initialized |
| `onError` | `(error: Error)` | Error occurred |

#### Example

```typescript
session.on({
  onSessionInfo: (info) => {
    console.log('Session started:', info.sessionId);
    console.log('Model:', info.model);
  },
  onError: (error) => {
    showError(error.message);
  },
});
```

## Properties

### state

Current session state.

```typescript
get state(): SessionState
```

```typescript
type SessionState =
  | 'idle'           // Created, not connected
  | 'initializing'   // Connecting
  | 'ready'          // Ready for messages
  | 'processing'     // Waiting for response
  | 'waiting_tool'   // Waiting for tool result
  | 'completed'      // Session finished
  | 'error';         // Error state
```

---

### sessionId

The session's unique identifier.

```typescript
get sessionId(): string
```

## Helper Functions

### getAssistantText()

Extract text content from an assistant message.

```typescript
import { getAssistantText } from '@chucky.cloud/sdk';

function getAssistantText(msg: SDKMessage): string | null
```

#### Example

```typescript
for await (const msg of session.stream()) {
  if (msg.type === 'assistant') {
    const text = getAssistantText(msg);
    console.log(text);
  }
}
```

---

### getResultText()

Extract the result text from a result message.

```typescript
import { getResultText } from '@chucky.cloud/sdk';

function getResultText(msg: SDKMessage): string | null
```

## SDK Message Types

### SDKAssistantMessage

```typescript
interface SDKAssistantMessage {
  type: 'assistant';
  uuid: string;
  session_id: string;
  message: {
    role: 'assistant';
    content: ContentBlock[];
  };
  parent_tool_use_id: string | null;
}
```

### SDKResultMessage

```typescript
interface SDKResultMessageSuccess {
  type: 'result';
  subtype: 'success';
  uuid: string;
  session_id: string;
  duration_ms: number;
  duration_api_ms: number;
  is_error: boolean;
  num_turns: number;
  result: string;
  total_cost_usd: number;
  usage: {
    input_tokens: number;
    output_tokens: number;
    cache_creation_input_tokens: number;
    cache_read_input_tokens: number;
  };
}
```

### SDKSystemMessage

```typescript
interface SDKSystemMessageInit {
  type: 'system';
  subtype: 'init';
  uuid: string;
  session_id: string;
  cwd: string;
  tools: string[];
  mcp_servers: Array<{ name: string; status: string }>;
  model: string;
  permissionMode: string;
}
```

## Usage Patterns

### Basic Conversation

```typescript
const client = new ChuckyClient({ token });
const session = client.createSession();

// First turn
await session.send('Hi, my name is Alice');
for await (const msg of session.stream()) {
  if (msg.type === 'assistant') {
    console.log(getAssistantText(msg));
  }
}

// Second turn (Claude remembers context)
await session.send('What is my name?');
for await (const msg of session.stream()) {
  if (msg.type === 'assistant') {
    console.log(getAssistantText(msg)); // "Your name is Alice."
  }
}

session.close();
```

### Resuming Sessions

```typescript
// Get session ID from previous session
const savedSessionId = localStorage.getItem('sessionId');

if (savedSessionId) {
  const session = client.resumeSession(savedSessionId);
  await session.send('Continue our conversation');
  for await (const msg of session.stream()) {
    // handle messages
  }
} else {
  const session = client.createSession();
  // Save session ID after first message
  await session.send('Hello');
  for await (const msg of session.stream()) {
    if (msg.type === 'system') {
      localStorage.setItem('sessionId', msg.session_id);
    }
  }
}
```

### Error Handling

```typescript
const session = client.createSession();

try {
  await session.send('Complex query...');

  for await (const msg of session.stream()) {
    if (msg.type === 'result') {
      if (msg.subtype === 'success') {
        console.log('Result:', msg.result);
      } else {
        console.error('Error:', msg.errors);
      }
    }
  }
} catch (error) {
  if (error instanceof BudgetExceededError) {
    showUpgradePrompt();
  } else {
    showGenericError(error);
  }
} finally {
  session.close();
}
```

### Using `await using` (TypeScript 5.2+)

```typescript
{
  await using session = client.createSession();

  await session.send('Hello');
  for await (const msg of session.stream()) {
    // handle messages
  }
} // session.close() called automatically
```
